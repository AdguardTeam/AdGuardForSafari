# SPDX-FileCopyrightText: AdGuard Software Limited
#
# SPDX-License-Identifier: GPL-3.0-or-later

---
version: 2
plan:
  project-key: ADGMINI
  key: ADGMINIRSWLNT
  name: Run swiftlint
stages:
  - Base Stage:
      manual: false
      final: false
      jobs:
        - Run swiftlint

Run swiftlint:
  key: JOB1
  other:
    clean-working-dir: true
  tasks:
    - checkout: !include common/checkout-default-repo.yaml
    - checkout:
        description: Checkout Private Repository
        repository: sciter-adguard-mini-private
        path: adguard-mini-private
        force-clean-build: "true"
    - checkout:
        description: Checkout bitbucket-scripts Repository
        repository: bitbucket-scripts
        path: bitbucket-scripts
        force-clean-build: "true"
    - script:
        description: Configure
        interpreter: SHELL
        scripts:
          - ./bamboo-specs/scripts/configure.sh
        working-dir: main
    - script:
        description: Run swiftlint and publish report
        interpreter: SHELL
        scripts:
          - ./bamboo-specs/scripts/create_and_deploy_linter_report.sh "sciter" "adguard-mini" "${bamboo.planRepository.1.revision}" "${bamboo.secretToken}" "build" "../bitbucket-scripts/bitbucket-kit.py"
        working-dir: main
  requirements: !include common/build-requirements.yaml

repositories:
  - sciter-adguard-mini:
      scope: global
  - sciter-adguard-mini-private:
      scope: global
  - bitbucket-scripts:
      scope: global

branches:
  create: for-pull-request
  delete:
    after-deleted-days: 1
    after-inactive-days: 30
  integration:
    push-on-success: false
    merge-from: AdGuardMini app - run tests
  link-to-jira: true
branch-overrides:
  - master:
      triggers: [] # Swiftlint should not be run on the 'master' branch

notifications: []
labels: []
other:
  concurrent-build-plugin: system-default
